<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="WAVE CRM">
<meta name="theme-color" content="#0a0a0a">
<title>WAVE CRM</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #080c12;
    --surface: #0e1420;
    --surface2: #151d2e;
    --border: #1e2a3d;
    --accent: #5b9cf6;
    --accent2: #ff6b35;
    --text: #dce8ff;
    --muted: #4a5d7a;
    --cold: #3a7bd5;
    --warm: #f7b731;
    --hot: #ff6b35;
    --sold: #5b9cf6;
  }

- { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
background: var(â€“bg);
color: var(â€“text);
font-family: â€˜DM Monoâ€™, monospace;
min-height: 100vh;
overflow-x: hidden;
}

/* HEADER */
header {
position: sticky;
top: 0;
z-index: 100;
background: rgba(10,10,10,0.95);
backdrop-filter: blur(20px);
border-bottom: 1px solid var(â€“border);
padding: 16px 20px;
display: flex;
align-items: center;
justify-content: space-between;
}

.logo {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 800;
font-size: 22px;
letter-spacing: -0.5px;
}

.logo span { color: var(â€“accent); }

.header-stats {
display: flex;
gap: 16px;
align-items: center;
}

.rev-pill {
background: var(â€“accent);
color: #0a0a0a;
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 700;
font-size: 12px;
padding: 4px 10px;
border-radius: 20px;
letter-spacing: 0.5px;
}

/* NAV */
nav {
display: flex;
border-bottom: 1px solid var(â€“border);
background: var(â€“bg);
position: sticky;
top: 61px;
z-index: 99;
}

nav button {
flex: 1;
background: none;
border: none;
color: var(â€“muted);
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 600;
font-size: 12px;
letter-spacing: 1px;
text-transform: uppercase;
padding: 14px 0;
cursor: pointer;
transition: all 0.2s;
border-bottom: 2px solid transparent;
}

nav button.active {
color: var(â€“accent);
border-bottom-color: var(â€“accent);
}

/* PAGES */
.page { display: none; padding: 20px; padding-bottom: 100px; }
.page.active { display: block; }

/* STATS ROW */
.stats-row {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 10px;
margin-bottom: 24px;
}

.stat-card {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 12px;
padding: 14px 12px;
text-align: center;
}

.stat-card .num {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 800;
font-size: 22px;
color: var(â€“accent);
display: block;
}

.stat-card .label {
font-size: 9px;
color: var(â€“muted);
text-transform: uppercase;
letter-spacing: 1px;
margin-top: 2px;
}

/* SECTION HEADER */
.section-head {
display: flex;
align-items: center;
justify-content: space-between;
margin-bottom: 14px;
}

.section-title {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 700;
font-size: 13px;
letter-spacing: 1.5px;
text-transform: uppercase;
color: var(â€“muted);
}

/* LEAD CARD */
.lead-card {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 14px;
padding: 16px;
margin-bottom: 10px;
position: relative;
overflow: hidden;
transition: transform 0.15s;
cursor: pointer;
}

.lead-card:active { transform: scale(0.98); }

.lead-card::before {
content: â€˜â€™;
position: absolute;
left: 0; top: 0; bottom: 0;
width: 3px;
border-radius: 14px 0 0 14px;
}

.lead-card.cold::before { background: var(â€“cold); }
.lead-card.interested::before { background: var(â€“warm); }
.lead-card.negotiating::before { background: var(â€“hot); }
.lead-card.sold::before { background: var(â€“sold); }

.lead-top {
display: flex;
align-items: flex-start;
justify-content: space-between;
margin-bottom: 8px;
}

.lead-name {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 700;
font-size: 16px;
}

.stage-badge {
font-size: 9px;
font-weight: 500;
letter-spacing: 1px;
text-transform: uppercase;
padding: 3px 8px;
border-radius: 20px;
}

.stage-badge.cold { background: rgba(58,123,213,0.15); color: var(â€“cold); }
.stage-badge.interested { background: rgba(247,183,49,0.15); color: var(â€“warm); }
.stage-badge.negotiating { background: rgba(255,107,53,0.15); color: var(â€“hot); }
.stage-badge.sold { background: rgba(200,240,96,0.15); color: var(â€“sold); }

.lead-meta {
display: flex;
gap: 12px;
flex-wrap: wrap;
margin-bottom: 8px;
}

.lead-meta span {
font-size: 11px;
color: var(â€“muted);
display: flex;
align-items: center;
gap: 4px;
}

.follow-up-tag {
font-size: 10px;
padding: 2px 8px;
border-radius: 20px;
background: rgba(91,156,246,0.1);
color: var(â€“accent);
display: inline-block;
}

.follow-up-tag.overdue {
background: rgba(255,107,53,0.15);
color: var(â€“hot);
}

.lead-note {
font-size: 11px;
color: var(â€“muted);
margin-top: 6px;
font-style: italic;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}

/* ADD BUTTON */
.fab {
position: fixed;
bottom: 24px;
right: 20px;
width: 58px;
height: 58px;
background: var(â€“accent);
color: #0a0a0a;
border: none;
border-radius: 50%;
font-size: 26px;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
box-shadow: 0 4px 24px rgba(91,156,246,0.35);
z-index: 200;
font-weight: 300;
transition: transform 0.15s, box-shadow 0.15s;
}

.fab:active { transform: scale(0.92); box-shadow: 0 2px 12px rgba(91,156,246,0.2); }

/* MODAL */
.modal-overlay {
position: fixed;
inset: 0;
background: rgba(0,0,0,0.85);
z-index: 500;
display: none;
align-items: flex-end;
backdrop-filter: blur(4px);
}

.modal-overlay.open { display: flex; }

.modal {
background: var(â€“surface);
border-radius: 24px 24px 0 0;
padding: 24px 20px 40px;
width: 100%;
max-height: 90vh;
overflow-y: auto;
animation: slideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes slideUp {
from { transform: translateY(100%); }
to { transform: translateY(0); }
}

.modal-handle {
width: 40px;
height: 4px;
background: var(â€“border);
border-radius: 2px;
margin: 0 auto 20px;
}

.modal-title {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 800;
font-size: 20px;
margin-bottom: 20px;
}

/* FORM */
.form-group { margin-bottom: 16px; }

label {
display: block;
font-size: 10px;
letter-spacing: 1.5px;
text-transform: uppercase;
color: var(â€“muted);
margin-bottom: 6px;
}

input, select, textarea {
width: 100%;
background: var(â€“surface2);
border: 1px solid var(â€“border);
border-radius: 10px;
color: var(â€“text);
font-family: â€˜DM Monoâ€™, monospace;
font-size: 14px;
padding: 12px 14px;
outline: none;
transition: border-color 0.2s;
}

input:focus, select:focus, textarea:focus {
border-color: var(â€“accent);
}

select option { background: var(â€“surface2); }

textarea { resize: none; height: 70px; }

.btn-row {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 10px;
margin-top: 20px;
}

.btn {
padding: 14px;
border-radius: 12px;
border: none;
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 700;
font-size: 14px;
cursor: pointer;
transition: transform 0.15s;
}

.btn:active { transform: scale(0.97); }
.btn-primary { background: var(â€“accent); color: #0a0a0a; }
.btn-ghost { background: var(â€“surface2); color: var(â€“text); }
.btn-danger { background: rgba(255,107,53,0.15); color: var(â€“hot); }
.btn-full { grid-column: 1 / -1; }

/* PIPELINE VIEW */
.pipeline-stage {
margin-bottom: 24px;
}

.pipeline-stage-header {
display: flex;
align-items: center;
gap: 8px;
margin-bottom: 10px;
}

.stage-dot {
width: 8px; height: 8px;
border-radius: 50%;
}

.stage-dot.cold { background: var(â€“cold); }
.stage-dot.interested { background: var(â€“warm); }
.stage-dot.negotiating { background: var(â€“hot); }
.stage-dot.sold { background: var(â€“sold); }

.stage-name {
font-family: â€˜Syneâ€™, sans-serif;
font-size: 12px;
font-weight: 700;
letter-spacing: 1px;
text-transform: uppercase;
}

.stage-count {
font-size: 10px;
color: var(â€“muted);
margin-left: auto;
}

/* REVENUE PAGE */
.revenue-big {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 16px;
padding: 24px;
margin-bottom: 20px;
text-align: center;
}

.revenue-big .amount {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 800;
font-size: 42px;
color: var(â€“accent);
letter-spacing: -2px;
}

.revenue-big .sub {
font-size: 11px;
color: var(â€“muted);
letter-spacing: 1px;
text-transform: uppercase;
margin-top: 4px;
}

.sale-item {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 12px;
padding: 14px 16px;
margin-bottom: 8px;
display: flex;
align-items: center;
justify-content: space-between;
}

.sale-item .sale-name {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 700;
font-size: 14px;
}

.sale-item .sale-meta {
font-size: 10px;
color: var(â€“muted);
margin-top: 2px;
}

.sale-item .sale-amount {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 800;
font-size: 18px;
color: var(â€“accent);
}

/* Empty state */
.empty {
text-align: center;
padding: 40px 20px;
color: var(â€“muted);
font-size: 13px;
}

.empty .emoji { font-size: 32px; display: block; margin-bottom: 10px; }

/* Follow-up section */
.followup-urgent {
background: rgba(255,107,53,0.07);
border: 1px solid rgba(255,107,53,0.2);
border-radius: 14px;
padding: 16px;
margin-bottom: 20px;
}

.followup-urgent-title {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 700;
font-size: 11px;
letter-spacing: 1px;
text-transform: uppercase;
color: var(â€“hot);
margin-bottom: 10px;
}

/* Source tag */
.source-tag {
font-size: 9px;
padding: 2px 6px;
border-radius: 4px;
background: var(â€“surface2);
color: var(â€“muted);
text-transform: uppercase;
letter-spacing: 0.5px;
}

.edit-actions {
display: flex;
gap: 8px;
margin-top: 12px;
}

.edit-actions button {
flex: 1;
background: var(â€“surface2);
border: 1px solid var(â€“border);
color: var(â€“text);
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 600;
font-size: 11px;
letter-spacing: 0.5px;
padding: 8px;
border-radius: 8px;
cursor: pointer;
transition: all 0.15s;
}

.edit-actions .stage-btn:active { background: var(â€“surface); }

/* PRODUCER STYLES */
.week-banner {
display: flex;
align-items: center;
justify-content: space-between;
margin-bottom: 10px;
}

.week-label {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 800;
font-size: 15px;
}

.week-progress {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 700;
font-size: 13px;
color: var(â€“accent);
}

.week-total { color: var(â€“muted); font-weight: 400; }

.week-bar-track {
height: 6px;
background: var(â€“surface2);
border-radius: 3px;
overflow: hidden;
}

.week-bar-fill {
height: 100%;
background: var(â€“accent);
border-radius: 3px;
transition: width 0.5s ease;
}

.unsent-alert {
background: rgba(255,107,53,0.07);
border: 1px solid rgba(255,107,53,0.2);
border-radius: 14px;
padding: 14px 16px;
margin-bottom: 20px;
}

.unsent-alert-title {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 700;
font-size: 11px;
letter-spacing: 1px;
text-transform: uppercase;
color: var(â€“hot);
margin-bottom: 8px;
}

.unsent-names {
font-size: 12px;
color: var(â€“muted);
line-height: 1.6;
}

.producer-card {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 14px;
padding: 16px;
margin-bottom: 10px;
display: flex;
align-items: center;
gap: 14px;
cursor: pointer;
transition: transform 0.15s;
}

.producer-card:active { transform: scale(0.98); }

.producer-avatar {
width: 44px;
height: 44px;
border-radius: 50%;
background: var(â€“surface2);
border: 1px solid var(â€“border);
display: flex;
align-items: center;
justify-content: center;
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 800;
font-size: 16px;
color: var(â€“accent);
flex-shrink: 0;
}

.producer-info { flex: 1; min-width: 0; }

.producer-name {
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 700;
font-size: 15px;
margin-bottom: 3px;
}

.producer-meta {
font-size: 10px;
color: var(â€“muted);
text-transform: uppercase;
letter-spacing: 0.5px;
}

.sample-toggle {
display: flex;
flex-direction: column;
align-items: center;
gap: 4px;
flex-shrink: 0;
}

.toggle-btn {
width: 52px;
height: 28px;
border-radius: 14px;
border: none;
cursor: pointer;
position: relative;
transition: background 0.25s;
background: var(â€“surface2);
border: 1px solid var(â€“border);
}

.toggle-btn.sent { background: var(â€“accent); border-color: var(â€“accent); }

.toggle-knob {
position: absolute;
top: 3px;
left: 3px;
width: 20px;
height: 20px;
border-radius: 50%;
background: var(â€“muted);
transition: transform 0.25s, background 0.25s;
}

.toggle-btn.sent .toggle-knob {
transform: translateX(24px);
background: #0a0a0a;
}

.toggle-label {
font-size: 9px;
text-transform: uppercase;
letter-spacing: 0.5px;
color: var(â€“muted);
}

.toggle-label.sent { color: var(â€“accent); }

.mini-btn {
background: var(â€“surface2);
border: 1px solid var(â€“border);
color: var(â€“text);
font-family: â€˜Syneâ€™, sans-serif;
font-weight: 700;
font-size: 11px;
padding: 6px 12px;
border-radius: 8px;
cursor: pointer;
letter-spacing: 0.5px;
}

.sample-history {
margin-top: 6px;
display: flex;
gap: 4px;
flex-wrap: wrap;
}

.history-dot {
width: 8px; height: 8px;
border-radius: 50%;
background: var(â€“surface2);
border: 1px solid var(â€“border);
title: â€˜â€™;
}

.history-dot.sent-week { background: var(â€“accent); border-color: var(â€“accent); }

.email-tag {
display: inline-block;
font-size: 10px;
color: var(â€“accent);
text-decoration: none;
background: rgba(91,156,246,0.08);
border: 1px solid rgba(91,156,246,0.2);
border-radius: 6px;
padding: 2px 8px;
margin-top: 6px;
margin-bottom: 2px;
letter-spacing: 0.3px;
transition: background 0.15s;
}
.email-tag:active { background: rgba(91,156,246,0.2); }

.bar-chart { margin: 16px 0; }
.bar-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
.bar-label { font-size: 10px; color: var(â€“muted); width: 70px; text-align: right; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.bar-track { flex: 1; height: 8px; background: var(â€“surface2); border-radius: 4px; overflow: hidden; }
.bar-fill { height: 100%; background: var(â€“accent); border-radius: 4px; transition: width 0.6s ease; }
.bar-val { font-size: 10px; color: var(â€“accent); font-family: â€˜Syneâ€™, sans-serif; font-weight: 700; width: 40px; }

</style>
</head>
<body>

<header>
  <div class="logo">WAVE<span>.</span>CRM</div>
  <div class="header-stats">
    <div class="rev-pill" id="headerRev">$0 earned</div>
  </div>
</header>

<nav>
  <button class="active" onclick="showPage('dashboard')">Dashboard</button>
  <button onclick="showPage('pipeline')">Pipeline</button>
  <button onclick="showPage('producers')">Producers</button>
  <button onclick="showPage('revenue')">Revenue</button>
</nav>

<div id="page-dashboard" class="page active">
  <!-- Follow-ups -->
  <div id="urgentSection"></div>

  <!-- Stats -->

  <div class="stats-row">
    <div class="stat-card">
      <span class="num" id="statLeads">0</span>
      <span class="label">Leads</span>
    </div>
    <div class="stat-card">
      <span class="num" id="statHot">0</span>
      <span class="label">Hot</span>
    </div>
    <div class="stat-card">
      <span class="num" id="statSales">0</span>
      <span class="label">Sales</span>
    </div>
  </div>

  <!-- Recent leads -->

  <div class="section-head">
    <span class="section-title">Recent Leads</span>
  </div>
  <div id="recentLeads"></div>
</div>

<div id="page-pipeline" class="page">
  <div id="pipelineView"></div>
</div>

<div id="page-producers" class="page">
  <!-- Week banner -->
  <div class="week-banner">
    <div class="week-label" id="weekLabel"></div>
    <div class="week-progress">
      <span id="weekSentCount">0</span><span class="week-total" id="weekTotalCount"> / 0 sent</span>
    </div>
  </div>

  <!-- Progress bar -->

  <div class="week-bar-track" style="margin-bottom:20px">
    <div class="week-bar-fill" id="weekBarFill" style="width:0%"></div>
  </div>

  <!-- Unsent alert -->

  <div id="unsentAlert"></div>

  <!-- Producer list -->

  <div class="section-head">
    <span class="section-title">Producers</span>
    <button class="mini-btn" onclick="openAddProducerModal()">+ Add</button>
  </div>
  <div id="producerList"></div>
</div>

<div id="page-revenue" class="page">
  <div class="revenue-big">
    <div class="amount" id="totalRevenue">$0</div>
    <div class="sub">Total Earned</div>
  </div>

  <div class="section-head">
    <span class="section-title">By Source</span>
  </div>
  <div class="bar-chart" id="sourceChart"></div>

  <div class="section-head" style="margin-top:20px">
    <span class="section-title">Sales Log</span>
  </div>
  <div id="salesLog"></div>
</div>

<!-- FAB -->

<button class="fab" onclick="openAddModal()">+</button>

<!-- ADD LEAD MODAL -->

<div class="modal-overlay" id="addModal" onclick="closeOnOverlay(event, 'addModal')">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">New Lead</div>

```
<div class="form-group">
  <label>Name / Handle</label>
  <input type="text" id="f-name" placeholder="@artistname">
</div>
<div class="form-group">
  <label>Source</label>
  <select id="f-source">
    <option value="YouTube">YouTube</option>
    <option value="Instagram">Instagram</option>
    <option value="TikTok">TikTok</option>
    <option value="Direct">Direct</option>
    <option value="Referral">Referral</option>
    <option value="Other">Other</option>
  </select>
</div>
<div class="form-group">
  <label>Stage</label>
  <select id="f-stage">
    <option value="cold">Cold</option>
    <option value="interested">Interested</option>
    <option value="negotiating">Negotiating</option>
  </select>
</div>
<div class="form-group">
  <label>Email</label>
  <input type="email" id="f-email" placeholder="artist@email.com">
</div>
<div class="form-group">
  <label>Interest (beat / pack)</label>
  <input type="text" id="f-interest" placeholder="Trap beat, bundle, exclusive...">
</div>
<div class="form-group">
  <label>Follow-up Date</label>
  <input type="date" id="f-followup">
</div>
<div class="form-group">
  <label>Notes</label>
  <textarea id="f-notes" placeholder="What did they say? Any details..."></textarea>
</div>

<div class="btn-row">
  <button class="btn btn-ghost" onclick="closeModal('addModal')">Cancel</button>
  <button class="btn btn-primary" onclick="saveLead()">Save Lead</button>
</div>
```

  </div>
</div>

<!-- EDIT LEAD MODAL -->

<div class="modal-overlay" id="editModal" onclick="closeOnOverlay(event, 'editModal')">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">Edit Lead</div>

```
<div class="form-group">
  <label>Name / Handle</label>
  <input type="text" id="e-name" placeholder="@artistname">
</div>
<div class="form-group">
  <label>Source</label>
  <select id="e-source">
    <option value="YouTube">YouTube</option>
    <option value="Instagram">Instagram</option>
    <option value="TikTok">TikTok</option>
    <option value="Direct">Direct</option>
    <option value="Referral">Referral</option>
    <option value="Other">Other</option>
  </select>
</div>
<div class="form-group">
  <label>Stage</label>
  <select id="e-stage">
    <option value="cold">Cold</option>
    <option value="interested">Interested</option>
    <option value="negotiating">Negotiating</option>
    <option value="sold">Sold</option>
  </select>
</div>
<div class="form-group">
  <label>Interest (beat / pack)</label>
  <input type="text" id="e-interest" placeholder="Trap beat, bundle, exclusive...">
</div>
<div class="form-group">
  <label>Email</label>
  <input type="email" id="e-email" placeholder="artist@email.com">
</div>
<div class="form-group" id="e-amount-group" style="display:none">
  <label>Sale Amount ($)</label>
  <input type="number" id="e-amount" placeholder="e.g. 50" min="0">
</div>
<div class="form-group">
  <label>Follow-up Date</label>
  <input type="date" id="e-followup">
</div>
<div class="form-group">
  <label>Notes</label>
  <textarea id="e-notes" placeholder="What did they say? Any details..."></textarea>
</div>

<div class="btn-row">
  <button class="btn btn-ghost" onclick="closeModal('editModal')">Cancel</button>
  <button class="btn btn-primary" onclick="updateLead()">Update</button>
</div>
<div class="btn-row" style="margin-top:8px">
  <button class="btn btn-danger btn-full" onclick="deleteLead()">Delete Lead</button>
</div>
```

  </div>
</div>

<script>
// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let leads = [];
let producers = [];
let editingId = null;
let editingProducerId = null;

function getWeekKey() {
  const now = new Date();
  const jan1 = new Date(now.getFullYear(), 0, 1);
  const week = Math.ceil(((now - jan1) / 86400000 + jan1.getDay() + 1) / 7);
  return `${now.getFullYear()}-W${week}`;
}

function getWeekLabel() {
  const now = new Date();
  const startOfWeek = new Date(now);
  startOfWeek.setDate(now.getDate() - now.getDay());
  const endOfWeek = new Date(startOfWeek);
  endOfWeek.setDate(startOfWeek.getDate() + 6);
  const fmt = d => d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  return `Week of ${fmt(startOfWeek)} â€“ ${fmt(endOfWeek)}`;
}

function saveData() {
  try { window.storage && window.storage.set('waveCRM_leads', JSON.stringify(leads), false); } catch(e) {}
  try { window.storage && window.storage.set('waveCRM_producers', JSON.stringify(producers), false); } catch(e) {}
  localStorage.setItem('waveCRM_leads', JSON.stringify(leads));
  localStorage.setItem('waveCRM_producers', JSON.stringify(producers));
}

async function loadData() {
  try {
    if (window.storage) {
      const r = await window.storage.get('waveCRM_leads', false);
      if (r && r.value) leads = JSON.parse(r.value);
      const rp = await window.storage.get('waveCRM_producers', false);
      if (rp && rp.value) { producers = JSON.parse(rp.value); return; }
    }
  } catch(e) {}
  try {
    const ls = localStorage.getItem('waveCRM_leads');
    if (ls) leads = JSON.parse(ls);
    const lsp = localStorage.getItem('waveCRM_producers');
    if (lsp) producers = JSON.parse(lsp);
  } catch(e) {}
}

// â”€â”€â”€ NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  event.target.classList.add('active');
  render();
}

// â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openAddModal() {
  document.getElementById('f-name').value = '';
  document.getElementById('f-source').value = 'Instagram';
  document.getElementById('f-stage').value = 'cold';
  document.getElementById('f-email').value = '';
  document.getElementById('f-interest').value = '';
  document.getElementById('f-followup').value = '';
  document.getElementById('f-notes').value = '';
  document.getElementById('addModal').classList.add('open');
}

function closeModal(id) { document.getElementById(id).classList.remove('open'); }

function closeOnOverlay(e, id) {
  if (e.target === document.getElementById(id)) closeModal(id);
}

function saveLead() {
  const name = document.getElementById('f-name').value.trim();
  if (!name) { alert('Please enter a name'); return; }
  const lead = {
    id: Date.now().toString(),
    name,
    source: document.getElementById('f-source').value,
    stage: document.getElementById('f-stage').value,
    email: document.getElementById('f-email').value.trim(),
    interest: document.getElementById('f-interest').value.trim(),
    followup: document.getElementById('f-followup').value,
    notes: document.getElementById('f-notes').value.trim(),
    amount: 0,
    createdAt: new Date().toISOString()
  };
  leads.unshift(lead);
  saveData();
  closeModal('addModal');
  render();
}

function openEditModal(id) {
  const lead = leads.find(l => l.id === id);
  if (!lead) return;
  editingId = id;
  document.getElementById('e-name').value = lead.name;
  document.getElementById('e-source').value = lead.source;
  document.getElementById('e-stage').value = lead.stage;
  document.getElementById('e-email').value = lead.email || '';
  document.getElementById('e-interest').value = lead.interest || '';
  document.getElementById('e-followup').value = lead.followup || '';
  document.getElementById('e-notes').value = lead.notes || '';
  document.getElementById('e-amount').value = lead.amount || '';
  document.getElementById('e-amount-group').style.display =
    lead.stage === 'sold' ? 'block' : 'none';
  document.getElementById('editModal').classList.add('open');

  document.getElementById('e-stage').onchange = function() {
    document.getElementById('e-amount-group').style.display =
      this.value === 'sold' ? 'block' : 'none';
  };
}

function updateLead() {
  const lead = leads.find(l => l.id === editingId);
  if (!lead) return;
  lead.name = document.getElementById('e-name').value.trim() || lead.name;
  lead.source = document.getElementById('e-source').value;
  lead.stage = document.getElementById('e-stage').value;
  lead.email = document.getElementById('e-email').value.trim();
  lead.interest = document.getElementById('e-interest').value.trim();
  lead.followup = document.getElementById('e-followup').value;
  lead.notes = document.getElementById('e-notes').value.trim();
  if (lead.stage === 'sold') {
    lead.amount = parseFloat(document.getElementById('e-amount').value) || 0;
    lead.soldAt = lead.soldAt || new Date().toISOString();
  }
  saveData();
  closeModal('editModal');
  render();
}

function deleteLead() {
  if (!confirm('Delete this lead?')) return;
  leads = leads.filter(l => l.id !== editingId);
  saveData();
  closeModal('editModal');
  render();
}

// â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render() {
  renderDashboard();
  renderPipeline();
  renderProducers();
  renderRevenue();
}

function stageOrder(s) {
  return { cold: 0, interested: 1, negotiating: 2, sold: 3 }[s] ?? 0;
}

function formatDate(str) {
  if (!str) return null;
  const d = new Date(str + 'T00:00:00');
  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

function isOverdue(str) {
  if (!str) return false;
  return new Date(str + 'T00:00:00') < new Date(new Date().toDateString());
}

function isToday(str) {
  if (!str) return false;
  return new Date(str + 'T00:00:00').toDateString() === new Date().toDateString();
}

function leadCard(lead, showFullStage = false) {
  const overdue = isOverdue(lead.followup);
  const today = isToday(lead.followup);
  let followupHTML = '';
  if (lead.followup) {
    const cls = overdue ? 'overdue' : '';
    const label = overdue ? 'âš  Overdue: ' + formatDate(lead.followup) :
                  today ? 'ğŸ“… Today!' : 'ğŸ“… ' + formatDate(lead.followup);
    followupHTML = `<span class="follow-up-tag ${cls}">${label}</span>`;
  }

  return `
    <div class="lead-card ${lead.stage}" onclick="openEditModal('${lead.id}')">
      <div class="lead-top">
        <div class="lead-name">${lead.name}</div>
        <span class="stage-badge ${lead.stage}">${lead.stage}</span>
      </div>
      <div class="lead-meta">
        <span><span class="source-tag">${lead.source}</span></span>
        ${lead.interest ? `<span>ğŸµ ${lead.interest}</span>` : ''}
        ${lead.stage === 'sold' && lead.amount ? `<span style="color:var(--accent)">$${lead.amount}</span>` : ''}
      </div>
      ${lead.email ? `<a class="email-tag" href="mailto:${lead.email}" onclick="event.stopPropagation()">âœ‰ ${lead.email}</a>` : ''}
      ${followupHTML}
      ${lead.notes ? `<div class="lead-note">${lead.notes}</div>` : ''}
    </div>`;
}

function renderDashboard() {
  const hot = leads.filter(l => l.stage === 'negotiating' || l.stage === 'interested');
  const sold = leads.filter(l => l.stage === 'sold');
  const overdue = leads.filter(l => isOverdue(l.followup) && l.stage !== 'sold');
  const todayFollowups = leads.filter(l => isToday(l.followup) && l.stage !== 'sold');

  document.getElementById('statLeads').textContent = leads.filter(l => l.stage !== 'sold').length;
  document.getElementById('statHot').textContent = leads.filter(l => l.stage === 'negotiating').length;
  document.getElementById('statSales').textContent = sold.length;

  const totalRev = sold.reduce((s, l) => s + (l.amount || 0), 0);
  document.getElementById('headerRev').textContent = '$' + totalRev.toLocaleString() + ' earned';

  // Urgent section
  const urgent = [...overdue, ...todayFollowups.filter(l => !overdue.includes(l))];
  const urgentEl = document.getElementById('urgentSection');
  if (urgent.length) {
    urgentEl.innerHTML = `
      <div class="followup-urgent">
        <div class="followup-urgent-title">âš¡ Follow Up Now (${urgent.length})</div>
        ${urgent.slice(0,3).map(l => leadCard(l)).join('')}
      </div>`;
  } else {
    urgentEl.innerHTML = '';
  }

  // Recent leads (non-sold, last 5)
  const active = leads.filter(l => l.stage !== 'sold').slice(0, 6);
  const recentEl = document.getElementById('recentLeads');
  if (!active.length) {
    recentEl.innerHTML = `<div class="empty"><span class="emoji">ğŸ¯</span>No leads yet. Hit + to add your first one.</div>`;
  } else {
    recentEl.innerHTML = active.map(l => leadCard(l)).join('');
  }
}

function renderPipeline() {
  const stages = [
    { key: 'cold', label: 'Cold' },
    { key: 'interested', label: 'Interested' },
    { key: 'negotiating', label: 'Negotiating' },
    { key: 'sold', label: 'Sold' },
  ];
  const el = document.getElementById('pipelineView');
  el.innerHTML = stages.map(s => {
    const stageLeads = leads.filter(l => l.stage === s.key);
    return `
      <div class="pipeline-stage">
        <div class="pipeline-stage-header">
          <div class="stage-dot ${s.key}"></div>
          <div class="stage-name">${s.label}</div>
          <div class="stage-count">${stageLeads.length} lead${stageLeads.length !== 1 ? 's' : ''}</div>
        </div>
        ${stageLeads.length ? stageLeads.map(l => leadCard(l)).join('') :
          `<div style="color:var(--muted);font-size:12px;padding:8px 0 4px">None here yet</div>`}
      </div>`;
  }).join('');
}

function renderRevenue() {
  const sold = leads.filter(l => l.stage === 'sold');
  const total = sold.reduce((s, l) => s + (l.amount || 0), 0);
  document.getElementById('totalRevenue').textContent = '$' + total.toLocaleString();

  // By source
  const bySource = {};
  sold.forEach(l => {
    bySource[l.source] = (bySource[l.source] || 0) + (l.amount || 0);
  });
  const maxVal = Math.max(...Object.values(bySource), 1);
  const chartEl = document.getElementById('sourceChart');
  if (!Object.keys(bySource).length) {
    chartEl.innerHTML = `<div class="empty" style="padding:16px 0"><span class="emoji">ğŸ“Š</span>No sales yet</div>`;
  } else {
    chartEl.innerHTML = Object.entries(bySource)
      .sort((a, b) => b[1] - a[1])
      .map(([src, val]) => `
        <div class="bar-row">
          <div class="bar-label">${src}</div>
          <div class="bar-track"><div class="bar-fill" style="width:${(val/maxVal)*100}%"></div></div>
          <div class="bar-val">$${val}</div>
        </div>`).join('');
  }

  // Sales log
  const logEl = document.getElementById('salesLog');
  if (!sold.length) {
    logEl.innerHTML = `<div class="empty"><span class="emoji">ğŸ’¸</span>Close your first deal to see it here.</div>`;
  } else {
    logEl.innerHTML = sold
      .sort((a, b) => new Date(b.soldAt || b.createdAt) - new Date(a.soldAt || a.createdAt))
      .map(l => `
        <div class="sale-item">
          <div>
            <div class="sale-name">${l.name}</div>
            <div class="sale-meta">${l.source} Â· ${l.interest || 'beat'}</div>
          </div>
          <div class="sale-amount">$${l.amount || 0}</div>
        </div>`).join('');
  }
}

// â”€â”€â”€ PRODUCER MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openAddProducerModal() {
  document.getElementById('p-name').value = '';
  document.getElementById('p-platform').value = 'Instagram';
  document.getElementById('p-genre').value = '';
  document.getElementById('p-email').value = '';
  document.getElementById('p-notes').value = '';
  document.getElementById('addProducerModal').classList.add('open');
}

function saveProducer() {
  const name = document.getElementById('p-name').value.trim();
  if (!name) { alert('Please enter a name'); return; }
  producers.push({
    id: Date.now().toString(),
    name,
    platform: document.getElementById('p-platform').value,
    genre: document.getElementById('p-genre').value.trim(),
    email: document.getElementById('p-email').value.trim(),
    notes: document.getElementById('p-notes').value.trim(),
    sentWeeks: []
  });
  saveData();
  closeModal('addProducerModal');
  render();
}

function openEditProducerModal(id) {
  const p = producers.find(p => p.id === id);
  if (!p) return;
  editingProducerId = id;
  document.getElementById('ep-name').value = p.name;
  document.getElementById('ep-platform').value = p.platform;
  document.getElementById('ep-genre').value = p.genre || '';
  document.getElementById('ep-email').value = p.email || '';
  document.getElementById('ep-notes').value = p.notes || '';
  document.getElementById('editProducerModal').classList.add('open');
}

function updateProducer() {
  const p = producers.find(p => p.id === editingProducerId);
  if (!p) return;
  p.name = document.getElementById('ep-name').value.trim() || p.name;
  p.platform = document.getElementById('ep-platform').value;
  p.genre = document.getElementById('ep-genre').value.trim();
  p.email = document.getElementById('ep-email').value.trim();
  p.notes = document.getElementById('ep-notes').value.trim();
  saveData();
  closeModal('editProducerModal');
  render();
}

function deleteProducer() {
  if (!confirm('Remove this producer?')) return;
  producers = producers.filter(p => p.id !== editingProducerId);
  saveData();
  closeModal('editProducerModal');
  render();
}

function toggleSample(id, event) {
  event.stopPropagation();
  const p = producers.find(p => p.id === id);
  if (!p) return;
  const week = getWeekKey();
  if (p.sentWeeks.includes(week)) {
    p.sentWeeks = p.sentWeeks.filter(w => w !== week);
  } else {
    p.sentWeeks.push(week);
  }
  saveData();
  render();
}

// â”€â”€â”€ PRODUCER RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderProducers() {
  const week = getWeekKey();
  const total = producers.length;
  const sent = producers.filter(p => p.sentWeeks.includes(week)).length;
  const pct = total ? Math.round((sent / total) * 100) : 0;

  document.getElementById('weekLabel').textContent = getWeekLabel();
  document.getElementById('weekSentCount').textContent = sent;
  document.getElementById('weekTotalCount').textContent = ` / ${total} sent this week`;
  document.getElementById('weekBarFill').style.width = pct + '%';

  // Unsent alert
  const unsent = producers.filter(p => !p.sentWeeks.includes(week));
  const alertEl = document.getElementById('unsentAlert');
  if (unsent.length && total > 0) {
    alertEl.innerHTML = `
      <div class="unsent-alert">
        <div class="unsent-alert-title">ğŸ“¬ Still need samples (${unsent.length})</div>
        <div class="unsent-names">${unsent.map(p => p.name).join(' Â· ')}</div>
      </div>`;
  } else if (total > 0 && sent === total) {
    alertEl.innerHTML = `
      <div class="unsent-alert" style="background:rgba(200,240,96,0.07);border-color:rgba(200,240,96,0.2)">
        <div class="unsent-alert-title" style="color:var(--accent)">âœ… All samples sent this week!</div>
      </div>`;
  } else {
    alertEl.innerHTML = '';
  }

  // Producer list â€” unsent first
  const sorted = [
    ...producers.filter(p => !p.sentWeeks.includes(week)),
    ...producers.filter(p => p.sentWeeks.includes(week))
  ];

  const el = document.getElementById('producerList');
  if (!producers.length) {
    el.innerHTML = `<div class="empty"><span class="emoji">ğŸ›ï¸</span>No producers yet. Hit "+ Add" to get started.</div>`;
    return;
  }

  el.innerHTML = sorted.map(p => {
    const isSent = p.sentWeeks.includes(week);
    const initials = p.name.replace('@','').slice(0,2).toUpperCase();
    // Last 8 weeks history dots
    const now = new Date();
    const dots = Array.from({length: 8}, (_, i) => {
      const d = new Date(now);
      d.setDate(now.getDate() - i * 7);
      const jan1 = new Date(d.getFullYear(), 0, 1);
      const w = Math.ceil(((d - jan1) / 86400000 + jan1.getDay() + 1) / 7);
      const key = `${d.getFullYear()}-W${w}`;
      return `<div class="history-dot ${p.sentWeeks.includes(key) ? 'sent-week' : ''}" title="${key}"></div>`;
    }).reverse().join('');

    return `
      <div class="producer-card" onclick="openEditProducerModal('${p.id}')">
        <div class="producer-avatar">${initials}</div>
        <div class="producer-info">
          <div class="producer-name">${p.name}</div>
          <div class="producer-meta">${p.platform}${p.genre ? ' Â· ' + p.genre : ''}</div>
          ${p.email ? `<a class="email-tag" href="mailto:${p.email}" onclick="event.stopPropagation()">âœ‰ ${p.email}</a>` : ''}
          <div class="sample-history">${dots}</div>
        </div>
        <div class="sample-toggle" onclick="toggleSample('${p.id}', event)">
          <button class="toggle-btn ${isSent ? 'sent' : ''}">
            <div class="toggle-knob"></div>
          </button>
          <span class="toggle-label ${isSent ? 'sent' : ''}">${isSent ? 'Sent âœ“' : 'Not sent'}</span>
        </div>
      </div>`;
  }).join('');
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(async () => {
  await loadData();
  render();
})();
</script>

<!-- ADD PRODUCER MODAL -->

<div class="modal-overlay" id="addProducerModal" onclick="closeOnOverlay(event, 'addProducerModal')">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">Add Producer</div>
    <div class="form-group">
      <label>Name / Handle</label>
      <input type="text" id="p-name" placeholder="@producername">
    </div>
    <div class="form-group">
      <label>Platform</label>
      <select id="p-platform">
        <option value="Instagram">Instagram</option>
        <option value="TikTok">TikTok</option>
        <option value="Twitter">Twitter</option>
        <option value="Email">Email</option>
        <option value="Discord">Discord</option>
        <option value="Other">Other</option>
      </select>
    </div>
    <div class="form-group">
      <label>Genre / Vibe</label>
      <input type="text" id="p-genre" placeholder="Trap, R&B, Drill...">
    </div>
    <div class="form-group">
      <label>Email</label>
      <input type="email" id="p-email" placeholder="producer@email.com">
    </div>
    <div class="form-group">
      <label>Notes</label>
      <textarea id="p-notes" placeholder="Collab history, preferences..."></textarea>
    </div>
    <div class="btn-row">
      <button class="btn btn-ghost" onclick="closeModal('addProducerModal')">Cancel</button>
      <button class="btn btn-primary" onclick="saveProducer()">Add Producer</button>
    </div>
  </div>
</div>

<!-- EDIT PRODUCER MODAL -->

<div class="modal-overlay" id="editProducerModal" onclick="closeOnOverlay(event, 'editProducerModal')">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">Edit Producer</div>
    <div class="form-group">
      <label>Name / Handle</label>
      <input type="text" id="ep-name" placeholder="@producername">
    </div>
    <div class="form-group">
      <label>Platform</label>
      <select id="ep-platform">
        <option value="Instagram">Instagram</option>
        <option value="TikTok">TikTok</option>
        <option value="Twitter">Twitter</option>
        <option value="Email">Email</option>
        <option value="Discord">Discord</option>
        <option value="Other">Other</option>
      </select>
    </div>
    <div class="form-group">
      <label>Genre / Vibe</label>
      <input type="text" id="ep-genre" placeholder="Trap, R&B, Drill...">
    </div>
    <div class="form-group">
      <label>Email</label>
      <input type="email" id="ep-email" placeholder="producer@email.com">
    </div>
    <div class="form-group">
      <label>Notes</label>
      <textarea id="ep-notes" placeholder="Collab history, preferences..."></textarea>
    </div>
    <div class="btn-row">
      <button class="btn btn-ghost" onclick="closeModal('editProducerModal')">Cancel</button>
      <button class="btn btn-primary" onclick="updateProducer()">Save</button>
    </div>
    <div class="btn-row" style="margin-top:8px">
      <button class="btn btn-danger btn-full" onclick="deleteProducer()">Remove Producer</button>
    </div>
  </div>
</div>

</body>
</html>